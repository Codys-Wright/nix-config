# Hyprland Workflows - Implementation Complete âœ…

Complete workflow system for Hyprland with HyDE integration.

## ğŸ“Š What Was Built

### Core System
- **Workflow Module** (`workflows/workflows.nix`) - Main Home Manager module
- **Workflow Switcher** (`scripts/workflow-switcher.nix`) - CLI tool for switching
- **Integration** - Modified existing config files to integrate workflows

### Presets from HyDE

#### ğŸ¬ Animations (19 presets)
All as individual `.nix` files in `presets/animations/`:
- classic, diablo-1, diablo-2, disable, dynamic
- end4, fast, high, ja, lime-frenzy
- me-1, me-2, minimal-1, minimal-2, moving
- optimized, standard, theme, vertical

#### ğŸ¨ Shaders (10 shaders)
Organized in `presets/shaders/`:
- `shaders.nix` - Main module exporting all shader presets
- `_shaderfiles/` - Directory with actual GLSL files copied from HyDE
  - blue-light-filter.frag
  - color-vision.frag
  - custom.frag
  - disable.frag
  - grayscale.frag
  - invert-colors.frag
  - oled-saver.frag
  - paper.frag
  - vibrance.frag
  - wallbash.frag

### Why Shaders Are Different

**Animations**: Keep as `.nix` files because they're just Nix data structures (bezier curves and timing).

**Shaders**: Use actual `.frag` GLSL files because:
- âœ… Easy to copy new shaders from HyDE or other sources
- âœ… Can edit shaders directly without Nix escaping
- âœ… Syntax highlighting works in editors
- âœ… Can include custom `.inc` files for user customization
- âœ… Single `shaders.nix` references all shader files

## ğŸ—‚ï¸ File Structure

```
modules/desktop/environment/hyprland/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ workflows.nix          # Main workflow module
â”‚   â”œâ”€â”€ _profiles/             # Individual profile files (NEW!)
â”‚   â”‚   â”‚                      # (underscore prevents import-tree auto-import)
â”‚   â”‚   â”œâ”€â”€ default.nix        # Balanced workflow
â”‚   â”‚   â”œâ”€â”€ focus.nix          # Minimal distractions
â”‚   â”‚   â”œâ”€â”€ gaming.nix         # Maximum performance
â”‚   â”‚   â”œâ”€â”€ development.nix    # Clean and functional
â”‚   â”‚   â”œâ”€â”€ music-production.nix # Smooth and creative
â”‚   â”‚   â”œâ”€â”€ aesthetic.nix      # Beautiful eye candy
â”‚   â”‚   â””â”€â”€ crazy.nix          # Wild effects
â”‚   â””â”€â”€ README.md             # Documentation
â”œâ”€â”€ presets/
â”‚   â”œâ”€â”€ animations/           # 19 .nix files (auto-discovered)
â”‚   â”‚   â”œâ”€â”€ classic.nix
â”‚   â”‚   â”œâ”€â”€ fast.nix
â”‚   â”‚   â””â”€â”€ ... (17 more)
â”‚   â””â”€â”€ shaders/
â”‚       â”œâ”€â”€ shaders.nix       # Single module for all shaders
â”‚       â”œâ”€â”€ README.md        # Shader documentation
â”‚       â””â”€â”€ _shaderfiles/    # Actual GLSL files (auto-discovered)
â”‚           â”œâ”€â”€ blue-light-filter.frag
â”‚           â”œâ”€â”€ grayscale.frag
â”‚           â””â”€â”€ ... (8 more)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run-or-raise.nix
â”‚   â””â”€â”€ workflow-switcher.nix # Workflow switching script (includes hyprctl reload)
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ walker.nix            # Walker + Elephant integration
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ binds.nix            # Added $mod+W keybinding
â”‚   â”œâ”€â”€ settings.nix         # Added workflow notes
â”‚   â”œâ”€â”€ monitors.nix
â”‚   â””â”€â”€ rules.nix
â””â”€â”€ hyprland.nix             # Auto-imports profiles from workflows/profiles/

Generated at runtime:
~/.config/hypr/
â”œâ”€â”€ profiles/               # Generated by Home Manager
â”‚   â”œâ”€â”€ default.conf
â”‚   â”œâ”€â”€ gaming.conf
â”‚   â””â”€â”€ ...
â””â”€â”€ profile.conf           # Symlink to active profile
```

## ğŸš€ Usage

### 1. Enable in Your Config

The system comes with **7 pre-built profiles** that are automatically loaded:
- `default` - Balanced workflow
- `Focus` - Minimal distractions
- `Gaming` - Maximum performance  
- `Development` - Clean and functional
- `Music-Production` - Smooth and creative
- `Aesthetic` - Beautiful eye candy
- `Crazy` - Wild effects

To enable workflows in your Hyprland config, workflows are **already enabled by default** in `hyprland.nix`!

### 2. Add Custom Profiles (Optional)

To add your own profile, create a new `.nix` file in `workflows/_profiles/`:

```nix
# workflows/_profiles/my-custom.nix
{
  name = "My-Custom";
  settings = {
    source = ["./presets/animations/optimized.conf"];
    decoration = {
      blur.enabled = true;
      rounding = 10;
      screen_shader = "./presets/shaders/vibrance.frag";
    };
    general = {
      gaps_in = 3;
      gaps_out = 5;
    };
  };
}
```

The profile will be **automatically discovered and loaded** on rebuild - no need to manually add it to any list!

### 2. Rebuild

```bash
nh home switch
# or
home-manager switch --flake .
```

### 3. Switch Workflows

```bash
# Interactive with walker (keybind: $mod + W)
hyprland-workflow-switcher --select walker

# Direct switch
hyprland-workflow-switcher --set gaming

# Check current
hyprland-workflow-switcher --get-current

# Reset to default
hyprland-workflow-switcher --reset
```

### 4. Customize Appearance at Runtime (NEW!)

**Keybind: `Super + Shift + A`** - Opens Hyprland Manager menu

The Hyprland Manager provides a two-tier menu system for runtime customization:

**Main Menu:**
- **Animations** - Change animation preset independently of workflow
- **Shaders** - Apply or disable shader effects
- **Reset to Workflow Defaults** - Restore workflow's original settings

**Command Line Usage:**
```bash
# Open main menu
hyprland-manager

# Direct to animations menu
hyprland-manager --animations

# Direct to shaders menu
hyprland-manager --shaders

# Reset to workflow defaults
hyprland-manager --reset
```

**How It Works:**
1. Workflow profiles declare animation/shader preferences via metadata
2. Preferences are written to `runtime-animation.conf` and `runtime-shader.conf`
3. You can override these at any time via the Hyprland Manager
4. Changes apply immediately with hot reload
5. Switch workflows to get new defaults, or reset to restore workflow settings

**Example Flow:**
1. Switch to "Gaming" workflow â†’ Gets `fast` animations + `vibrance.frag` shader
2. Press `Super+Shift+A` â†’ Animations â†’ Select `minimal-1` â†’ Animations change instantly
3. Press `Super+Shift+A` â†’ Shaders â†’ Select `None` â†’ Shader removed
4. Press `Super+Shift+A` â†’ Reset â†’ Back to Gaming workflow's defaults

## ğŸ¨ Adding New Shaders

Just drop a new `.frag` file in `_shaderfiles/` and add it to `shaders.nix`:

```nix
# In presets/shaders/shaders.nix
my-new-shader = {
  description = "My awesome shader";
  settings = {
    decoration = {
      screen_shader = "${./_shaderfiles/my-shader.frag}";
    };
  };
};
```

No need to escape strings or deal with Nix heredocs!

## ğŸ“ Customizing Shader Parameters

Create `.inc` files in `~/.config/hypr/shaders/`:

```glsl
// ~/.config/hypr/shaders/blue-light-filter.inc
#define BLUE_LIGHT_FILTER_TEMPERATURE 4000.0
#define BLUE_LIGHT_FILTER_INTENSITY 0.7
```

The shader will automatically include it.

## ğŸ¯ Key Features

âœ… **19 Animation Presets** from HyDE  
âœ… **10 Shader Presets** from HyDE  
âœ… **Declarative Configuration** - All in Nix  
âœ… **Easy Shader Management** - Just copy `.frag` files  
âœ… **Composable Workflows** - Mix animations + shaders + settings  
âœ… **Fast Switching** - Instant workflow changes  
âœ… **Walker Integration** - Beautiful menu ($mod + W)  
âœ… **User Customization** - Override shader params with `.inc` files  
âœ… **Runtime Modularity** - Change animations/shaders independently ($mod + Shift + A)  
âœ… **Hot Reloading** - See changes immediately with `hyprctl reload`  
âœ… **Two-Tier Menu** - Organized Hyprland Manager menu system  

## ğŸ“š Documentation

- `workflows/README.md` - Workflow system documentation
- `presets/shaders/README.md` - Shader documentation with all parameters

## âš ï¸ Important Notes

1. **One `default` workflow required**
2. **All workflow names must be unique**
3. **Settings in `config/settings.nix` override workflow settings**
4. **First load may show error** - run switcher once to initialize
5. **Hyprland auto-reloads** when switching workflows

## ğŸ‰ Success!

Your Hyprland workflow system is ready with:
- 19 animation styles
- 10 shader effects
- Easy to extend with more shaders
- Fully declarative in Nix
- Direct GLSL file support

Happy workflow switching! ğŸš€
