{"id":".flake-c1t","title":"Migrate Nix Config to Den/Vix Best Practices","description":"Migrate the nix-config flake to align with best practices from den, flake-aspects, flake-file, and the vix reference implementation.\n\nKey migration areas:\n1. Adopt den built-in batteries (define-user, primary-user, user-shell) instead of custom dendritic modules\n2. Simplify aspect definitions using vix-style flat patterns and dynamic class resolution\n3. Modernize flake-file configuration with fallback patterns and nix-auto-follow\n4. Restructure namespaces to separate community-reusable from personal aspects\n5. Simplify defaults.nix and remove redundant parametric routers\n6. Update CLAUDE.md and documentation to reflect new patterns","status":"open","priority":2,"issue_type":"epic","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:13:34.594945-08:00","created_by":"Cody Wright","updated_at":"2026-02-08T00:13:34.594945-08:00"}
{"id":".flake-c1t.1","title":"US-001: Replace custom dendritic user/host/home modules with den built-in batteries","description":"Replace the custom implementations in modules/dendritic/ with den's upstream provides.\n\n## Current State\n- `modules/dendritic/user.nix` - Custom user creation aspect\n- `modules/dendritic/host.nix` - Custom hostname configuration\n- `modules/dendritic/home.nix` - Custom home directory setup\n- `modules/dendritic/routes.nix` - Custom mutual dependency routing\n\n## Target State\nUse den's built-in batteries:\n- `\u003cden/define-user\u003e` instead of custom `den.aspects.dendritic._.user` + `den.aspects.dendritic._.home`\n- `\u003cden/primary-user\u003e` instead of custom admin user setup in `modules/user/admin.nix`\n- `\u003cden/user-shell\u003e` instead of custom `modules/coding/shell/user-shell.nix`\n- Keep `routes.nix` if still needed (den may handle this internally now)\n\n## Reference (from vix)\n```nix\n# vix/modules/defaults.nix - just 8 lines\n{ __findFile, ... }:\n{\n  den.default.includes = [\n    \u003cden/define-user\u003e\n    \u003cmy/nix-settings\u003e\n    \u003cmy/state-version\u003e\n    \u003cvix/hostname\u003e\n  ];\n}\n\n# vix/modules/my/user.nix\nmy.user = \u003cden.lib.parametric\u003e {\n  includes = [\n    \u003cden/primary-user\u003e\n    (\u003cden/user-shell\u003e \"fish\")\n    ...\n  ];\n};\n```\n\n## Acceptance Criteria\n- [ ] Replace dendritic/user.nix + dendritic/home.nix with `\u003cden/define-user\u003e` in defaults\n- [ ] Replace custom admin.nix with `\u003cden/primary-user\u003e` in user aspects\n- [ ] Replace custom user-shell.nix with `(\u003cden/user-shell\u003e \"fish\")` in user aspects\n- [ ] Verify dendritic/host.nix can be replaced with a simple hostname aspect like vix\n- [ ] Update dendritic/routes.nix if den handles mutual deps internally now\n- [ ] Update defaults.nix to remove references to replaced modules\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent darwin host builds successfully","status":"closed","priority":1,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:13:57.68027-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:31:18.316225-08:00","closed_at":"2026-02-09T01:31:18.316225-08:00","close_reason":"Implemented on dedicated ralph-parallel branch; awaiting merge.","dependencies":[{"issue_id":".flake-c1t.1","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:13:57.681857-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.10","title":"US-010: Add home-manager CLI package to user aspects following vix pattern","description":"Add home-manager CLI tool as a home.package like vix does.\n\n## Reference (vix home-manager.nix)\n```nix\n{ den, inputs, ... }:\n{\n  flake-file.inputs.home-manager.url = \"github:nix-community/home-manager\";\n  flake-file.inputs.home-manager.inputs.nixpkgs.follows = \"nixpkgs\";\n\n  den.default.includes = [ den._.home-manager den.aspects.hm den._.inputs' den._.self' ];\n\n  den.aspects.hm.homeManager = { pkgs, ... }: {\n    home.packages = [\n      inputs.home-manager.packages.${pkgs.stdenv.hostPlatform.system}.default\n    ];\n  };\n}\n```\n\n## Key Patterns from Vix\n1. Declares the home-manager input in the same file that uses it (colocation)\n2. Creates a small aspect (den.aspects.hm) that adds the home-manager CLI to home.packages\n3. Uses `den._.home-manager` shorthand (equivalent to `den.provides.home-manager`)\n4. Includes `den._.inputs'` and `den._.self'` for making inputs available\n\n## Current State\n- home-manager input is declared in modules/flake/dendritic.nix (separate file)\n- home-manager integration is in modules/flake/home-manager.nix\n- No aspect adding the home-manager CLI tool to home.packages\n\n## Acceptance Criteria\n- [ ] home-manager input declaration colocated with its usage module\n- [ ] den.aspects.hm (or equivalent) adds home-manager CLI to home.packages\n- [ ] Uses den shorthand (den._.home-manager) where appropriate\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"closed","priority":2,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:16:03.672158-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:31:18.320322-08:00","closed_at":"2026-02-09T01:31:18.320322-08:00","close_reason":"Implemented on dedicated ralph-parallel branch; awaiting merge.","dependencies":[{"issue_id":".flake-c1t.10","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:16:03.67305-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.11","title":"US-011: Remove redundant parametric routers where simple includes suffice","description":"Several modules define complex __functor parametric routers that are never actually called with parameters. Replace them with simple includes-based aspects.\n\n## Current Pattern (unnecessarily complex)\n```nix\n# modules/coding/coding.nix - 54 lines\nFTS.coding.__functor = _self:\n  { cli ? null, editors ? null, lang ? null, shells ? null, terminals ? null, tools ? null, ... }@args:\n  { class, aspect-chain }:\n  let\n    cliIncludes = lib.optionals (cli != null) [ (FTS.coding._.cli cli) ];\n    editorIncludes = lib.optionals (editors != null) [ (FTS.coding._.editors editors) ];\n    ...\n  in { includes = cliIncludes ++ editorIncludes ++ ...; };\n```\n\n## Target Pattern (vix-style simple includes)\n```nix\n# If coding is never called as (FTS.coding { cli = ...; editors = ...; }),\n# just make it a simple includes aspect:\nFTS.coding = {\n  description = \"All coding tools\";\n  includes = [\n    FTS.coding._.cli\n    FTS.coding._.editors\n    FTS.coding._.shells\n    FTS.coding._.terminals\n    FTS.coding._.lang\n    FTS.coding._.tools\n  ];\n};\n```\n\n## Analysis Required\nFor each __functor router, check:\n1. Is it actually called with parameters anywhere in hosts/users?\n2. If not, replace with simple includes\n3. If yes, keep the parametric behavior but simplify\n\n## Candidates to Audit\n- `FTS.coding.__functor` (modules/coding/coding.nix)\n- `FTS.deployment.__functor` (modules/deployment/deployment.nix) - likely needs to stay parametric\n- Any other __functor aspects in the codebase\n\n## Acceptance Criteria\n- [ ] Audit all __functor aspects for actual parameter usage\n- [ ] Replace unused parametric routers with simple includes\n- [ ] Keep genuinely parametric aspects (deployment, selfhost)\n- [ ] Update any call sites if signatures change\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"in_progress","priority":3,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:16:17.080631-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:08:22.532407-08:00","dependencies":[{"issue_id":".flake-c1t.11","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:16:17.085045-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.11","depends_on_id":".flake-c1t.5","type":"blocks","created_at":"2026-02-08T00:19:09.663714-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.12","title":"US-012: Clean up commented-out code and unused aspects","description":"Remove commented-out code, disabled aspects, and dead references throughout the codebase.\n\n## Examples of Current Cruft\nFrom defaults.nix:\n```nix\n# \u003cFTS/secrets\u003e  # SOPS secrets management - disabled, using SelfHostBlocks SOPS instead\n# (\u003cFTS/grub\u003e { })\n# \u003cFTS/secrets\u003e  # SOPS secrets infrastructure (home-manager part) - disabled\n```\n\nFrom starcommand.nix:\n```nix\n# FTS.mactahoe\n# FTS.apple-fonts\n# FTS.stylix\n```\n\nFrom dots.nix:\n```nix\n# home.file.\".config/nvim\".source = dotsLink \"config/nvim\";\n# home.file.\".config/zed\".source = dotsLink \"config/zed\";\n```\n\n## Changes Required\n1. Remove all commented-out aspect includes (they're in git history if needed)\n2. Remove unused aspect files if they exist\n3. Clean up TODO comments that have been resolved\n4. Remove dead module references\n\n## Acceptance Criteria\n- [ ] No commented-out aspect includes remain (except genuine documentation examples)\n- [ ] No unused/orphaned aspect files\n- [ ] No stale TODO comments\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"open","priority":4,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:16:27.829978-08:00","created_by":"Cody Wright","updated_at":"2026-02-08T01:38:05.60854-08:00","dependencies":[{"issue_id":".flake-c1t.12","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:16:27.834926-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.12","depends_on_id":".flake-c1t.2","type":"blocks","created_at":"2026-02-08T00:19:09.778602-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.12","depends_on_id":".flake-c1t.5","type":"blocks","created_at":"2026-02-08T00:19:09.891337-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.13","title":"US-013: Update CLAUDE.md and documentation to reflect new patterns","description":"Update CLAUDE.md and project documentation to reflect the migrated patterns.\n\n## Changes Required\n1. Update CLAUDE.md:\n   - Update Aspect Definition Pattern section to show vix-style patterns\n   - Add let...in pattern documentation\n   - Add ${host.class} dynamic pattern documentation\n   - Update module pattern to remove unnecessary args\n   - Add den provides batteries documentation\n   - Update directory structure if changed\n\n2. Update angle-brackets-guide.md if syntax has changed\n\n3. Remove outdated documentation:\n   - HYPRLAND_WORKFLOWS_IMPLEMENTATION.md (if stale)\n   - Any docs referencing old dendritic patterns\n\n4. Add new pattern examples:\n   - Simple aspect (no module args): `{ FTS.foo.nixos = { ... }; }`\n   - Dynamic class: `{ host, ... }: { ${host.class}.setting = val; }`\n   - let...in: `let my.foo = { ... }; in { inherit my; }`\n   - den batteries: `\u003cden/define-user\u003e`, `\u003cden/primary-user\u003e`, etc.\n\n## Acceptance Criteria\n- [ ] CLAUDE.md accurately reflects current architecture patterns\n- [ ] All example code in docs matches actual codebase patterns\n- [ ] New patterns from vix are documented\n- [ ] Den batteries usage documented\n- [ ] `just fmt` passes","status":"open","priority":4,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:16:39.716764-08:00","created_by":"Cody Wright","updated_at":"2026-02-08T01:28:09.791835-08:00","dependencies":[{"issue_id":".flake-c1t.13","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:16:39.718441-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.13","depends_on_id":".flake-c1t.1","type":"blocks","created_at":"2026-02-08T00:19:10.02587-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.13","depends_on_id":".flake-c1t.2","type":"blocks","created_at":"2026-02-08T00:19:10.160532-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.13","depends_on_id":".flake-c1t.3","type":"blocks","created_at":"2026-02-08T00:19:10.306866-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.13","depends_on_id":".flake-c1t.5","type":"blocks","created_at":"2026-02-08T00:19:10.512408-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.2","title":"US-002: Simplify defaults.nix to use den provides and minimal pattern","description":"Simplify modules/aspects/defaults.nix from 51 lines to a minimal pattern following vix.\n\n## Current State (51 lines)\n```nix\nden.default = {\n  includes = [\n    \u003cden/home-manager\u003e\n    den.aspects.dendritic._.routes\n    den.aspects.dendritic._.user\n    den.aspects.dendritic._.host\n    den.aspects.dendritic._.home\n    FTS.coding._.cli\n  ];\n  host.includes = [\n    \u003cFTS/nh\u003e\n    \u003cFTS/system\u003e\n    \u003cFTS/fonts\u003e\n    \u003cFTS/phoenix\u003e\n    \u003cFTS/experimental-features\u003e\n    (\u003cden/unfree\u003e true)\n    \u003cFTS/nix\u003e\n  ];\n  user.includes = [];\n  home.includes = [\n    \u003cFTS/nix\u003e\n    \u003cFTS/user-secrets\u003e\n    \u003cFTS/no-man-cache\u003e\n  ];\n};\n```\n\n## Target State (vix-style minimal)\n```nix\n{ __findFile, ... }:\n{\n  den.default.includes = [\n    \u003cden/define-user\u003e\n    \u003cFTS/nix-settings\u003e\n    \u003cFTS/state-version\u003e\n    \u003cFTS/hostname\u003e\n  ];\n}\n```\n\nWith host-level and home-level defaults moved into appropriate aspect includes rather than defaults.\n\n## Changes Required\n- Move host.includes items into the host aspects themselves (or a `\u003cFTS/base-host\u003e` aspect)\n- Move home.includes items into the user aspects (or a `\u003cFTS/base-home\u003e` aspect)  \n- Replace dendritic references with den provides\n- Create `\u003cFTS/state-version\u003e` aspect (like vix's my/state-version.nix)\n- Create `\u003cFTS/hostname\u003e` aspect (like vix's vix/hostname.nix using `${host.class}`)\n- Create `\u003cFTS/nix-settings\u003e` aspect consolidating nix configuration\n\n## Acceptance Criteria\n- [ ] defaults.nix is under 15 lines\n- [ ] Host-level defaults moved to a base-host aspect or host aspects\n- [ ] Home-level defaults moved to a base-home aspect or user aspects\n- [ ] State version aspect created using vix pattern\n- [ ] Hostname aspect created using dynamic `${host.class}` pattern\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"closed","priority":1,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:14:11.615764-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:31:36.747178-08:00","closed_at":"2026-02-09T01:31:36.747178-08:00","close_reason":"Implemented on dedicated ralph-parallel branch; awaiting merge.","dependencies":[{"issue_id":".flake-c1t.2","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:14:11.617511-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.2","depends_on_id":".flake-c1t.1","type":"blocks","created_at":"2026-02-08T00:19:08.812755-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.2","depends_on_id":".flake-c1t.8","type":"blocks","created_at":"2026-02-08T00:19:08.937668-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.3","title":"US-003: Adopt dynamic host.class pattern for cross-platform aspects","description":"Replace explicit nixos/darwin blocks with the dynamic ${host.class} pattern from vix.\n\n## Current Pattern (verbose)\n```nix\nFTS.system._.networking = {\n  nixos = { ... }: { systemd.network = { ... }; };\n  darwin = { ... }: { /* darwin networking */ };\n};\n```\n\n## Target Pattern (vix-style dynamic)\n```nix\n# For host-context aspects that need class-awareness\nvix.hostname = { host, ... }: {\n  ${host.class}.networking.hostName = host.hostName;\n};\n\n# For aspects that only apply to one class, keep explicit\nvix.kde-desktop.nixos = { pkgs, ... }: { ... };\n```\n\n## Aspects to Migrate\nIdentify aspects that use both `nixos = { ... }` and `darwin = { ... }` with similar config and consolidate using `${host.class}`. Aspects that are truly class-specific (e.g., only nixos) should keep explicit class blocks.\n\nKey candidates:\n- modules/dendritic/host.nix (hostname setting)\n- modules/system/networking.nix (if applicable)  \n- modules/nix/nix.nix (nix settings apply to both)\n- modules/nix/experimental-features.nix\n- Any aspect with duplicate nixos/darwin blocks\n\n## Acceptance Criteria\n- [ ] Aspects with identical nixos/darwin config use `${host.class}` or `${class}` pattern\n- [ ] Aspects that are class-specific keep explicit blocks (no unnecessary abstraction)\n- [ ] No functional changes to the generated configurations\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"in_progress","priority":2,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:14:26.842549-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:08:22.511301-08:00","dependencies":[{"issue_id":".flake-c1t.3","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:14:26.844717-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.3","depends_on_id":".flake-c1t.8","type":"blocks","created_at":"2026-02-08T00:19:09.064204-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.4","title":"US-004: Modernize flake-file dendritic.nix with fallback and nix-auto-follow","description":"Update the flake-file configuration to follow the latest vix patterns.\n\n## Current State (modules/flake/dendritic.nix)\n```nix\nimports = [\n  (inputs.flake-file.flakeModules.dendritic)\n  (inputs.den.flakeModules.dendritic)\n];\n```\n\n## Target State (vix pattern with fallbacks)\n```nix\nimports = [\n  (inputs.flake-file.flakeModules.dendritic or { })\n  (inputs.den.flakeModules.dendritic or { })\n];\n```\n\n## Additional Changes\n1. Add `or { }` fallback to all flakeModule imports (prevents boot failures if input temporarily unavailable)\n2. Consider adding nix-auto-follow for automatic lock flattening:\n   ```nix\n   flake-file.inputs.nix-auto-follow.url = \"github:fzakaria/nix-auto-follow\";\n   flake-file.inputs.nix-auto-follow.inputs.nixpkgs.follows = \"nixpkgs\";\n   ```\n3. Use nixpkgs tarball URL (faster) like vix:\n   ```nix\n   flake-file.inputs.nixpkgs.url = \"https://channels.nixos.org/nixos-unstable/nixexprs.tar.xz\";\n   ```\n4. Ensure all transitive dependencies use `.follows` to flatten lock file\n5. Remove the lib.mkForce on outputs if no longer needed\n\n## Acceptance Criteria\n- [ ] All flakeModule imports have `or { }` fallback\n- [ ] nix-auto-follow added as input (optional - discuss with user)\n- [ ] Transitive dependency follows are properly set up\n- [ ] `nix run .#write-flake` generates correct flake.nix\n- [ ] `just fmt` passes\n- [ ] `nix flake check` passes (if applicable)","status":"in_progress","priority":2,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:14:40.327513-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:08:22.50881-08:00","dependencies":[{"issue_id":".flake-c1t.4","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:14:40.329835-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.5","title":"US-005: Flatten unnecessarily nested aspect hierarchies","description":"Simplify overly nested aspect paths to follow vix's flat style where appropriate.\n\n## Current Pattern (deeply nested)\n```nix\nFTS.coding._.cli._.direnv = { ... };       # 4 levels deep\nFTS.coding._.cli._.btop = { ... };         # 4 levels deep\nFTS.desktop._.environment._.gnome = { ... }; # 4 levels deep\n```\n\n## Target Pattern (flat where possible)\n```nix\n# Vix style - flat for leaf aspects\nvic.direnv.homeManager = { ... };\nvix.gnome-desktop.nixos = { ... };\nvix.kde-desktop.nixos = { ... };\n\n# Only nest when there's a genuine grouping need\nmy.workstation.provides = {\n  hw.includes = [ ... ];\n  vm.includes = [ ... ];\n  base.includes = [ ... ];\n};\n```\n\n## Migration Strategy\nNot all nesting needs to be removed. The guideline is:\n- **Keep nesting** when an aspect has meaningful sub-aspects (e.g., `FTS.deployment._.config`, `FTS.deployment._.bootssh`)\n- **Flatten** when the nesting is purely organizational with no parametric behavior\n- **Facet routers** (like `FTS.coding.__functor`) may be simplified to simple includes if the parametric routing is not actually used\n\n## Candidates for Flattening\n1. `FTS.coding._.cli._.direnv` → `FTS.direnv` (leaf, no sub-aspects)\n2. `FTS.coding._.cli._.btop` → `FTS.btop` (leaf)\n3. `FTS.coding._.cli._.eza` → `FTS.eza` (leaf)\n4. `FTS.coding._.cli._.fzf` → `FTS.fzf` (leaf)\n5. Similar for other simple leaf aspects under coding/cli, coding/editor, etc.\n\n## Decision Points\n- Should the `FTS.coding` parametric router (__functor) be kept or replaced with simple includes?\n- Should cli-tools.nix grouping become a simple includes-only aspect?\n- Do user aspects reference these by the deep path (update needed if flattened)?\n\n## Acceptance Criteria\n- [ ] Leaf aspects that don't need nesting are flattened\n- [ ] Grouping aspects (facets) that use includes are preserved but simplified\n- [ ] All references to flattened aspects are updated across hosts/users/modules\n- [ ] No functional changes to generated configurations\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"open","priority":3,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:14:57.010642-08:00","created_by":"Cody Wright","updated_at":"2026-02-08T01:28:09.635124-08:00","dependencies":[{"issue_id":".flake-c1t.5","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:14:57.012532-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.5","depends_on_id":".flake-c1t.1","type":"blocks","created_at":"2026-02-08T00:19:09.179842-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.6","title":"US-006: Adopt let...in pattern for config-heavy aspects","description":"Use the let...in { inherit namespace; } pattern from vix for aspects with shared configuration logic.\n\n## Current Pattern (inline everything)\n```nix\n{ FTS, ... }: {\n  FTS.system._.networking = {\n    description = \"...\";\n    nixos = { config, lib, pkgs, ... }: {\n      # Long inline config\n    };\n    darwin = { config, lib, pkgs, ... }: {\n      # Duplicate config\n    };\n  };\n}\n```\n\n## Target Pattern (vix-style let...in)\n```nix\nlet\n  my.nix-settings = {\n    nixos = nix-settings;\n    darwin = nix-settings;\n  };\n\n  nix-settings = { pkgs, config, ... }: {\n    nix = {\n      optimise.automatic = true;\n      settings = { ... };\n    };\n  };\nin\n{\n  inherit my;\n}\n```\n\n## Benefits\n- Shared logic between nixos/darwin without duplication\n- Cleaner separation of aspect definition from config logic\n- No need for module args (`{ FTS, ... }:`) when not referencing other aspects\n- More readable for large configurations\n\n## Candidates\n1. modules/nix/nix.nix or equivalent - nix settings apply to both nixos and darwin\n2. modules/system/networking.nix - if networking config is shared\n3. Any aspect where nixos and darwin blocks have identical or near-identical config\n\n## Acceptance Criteria\n- [ ] Config-heavy aspects with shared nixos/darwin logic use let...in pattern\n- [ ] No duplication between nixos and darwin blocks where logic is the same\n- [ ] Aspects that don't reference FTS/den drop the module args wrapper\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"closed","priority":3,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:15:09.653448-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:31:36.749035-08:00","closed_at":"2026-02-09T01:31:36.749035-08:00","close_reason":"Implemented on dedicated ralph-parallel branch; awaiting merge.","dependencies":[{"issue_id":".flake-c1t.6","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:15:09.666253-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.6","depends_on_id":".flake-c1t.9","type":"blocks","created_at":"2026-02-08T00:19:09.323096-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.7","title":"US-007: Migrate user definitions to use den.lib.parametric angle bracket syntax","description":"Update user aspect definitions to use the \u003cden.lib.parametric\u003e angle bracket syntax from vix.\n\n## Current Pattern\n```nix\n# modules/coding/shell/user-shell.nix\nden.provides.user-shell = shell:\n  den.lib.parametric {\n    includes = [ ... ];\n  };\n\n# modules/system/password.nix\nden.provides.password = den.lib.parametric {\n  includes = [ ... ];\n};\n```\n\n## Target Pattern (vix-style)\n```nix\n# Much cleaner with angle bracket\nmy.user = \u003cden.lib.parametric\u003e {\n  includes = [\n    \u003cden/primary-user\u003e\n    (\u003cden/user-shell\u003e \"fish\")\n    \u003cvic/browser\u003e\n    \u003cvic/cli-tui\u003e\n    ...\n  ];\n};\n```\n\n## Changes Required\n1. Update user aspect definitions to use `\u003cden.lib.parametric\u003e` where appropriate\n2. Consolidate user configuration into the user aspect files (users/cody/cody.nix, etc.)\n3. Move reusable parametric aspects from `den.provides.*` to namespace aspects where they fit better\n\n## Acceptance Criteria\n- [ ] User aspects use `\u003cden.lib.parametric\u003e` syntax where applicable\n- [ ] Custom parametric providers that replicate den batteries are removed\n- [ ] User aspect files (cody.nix, starcommand.nix) are self-contained\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"open","priority":2,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:15:21.380743-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:08:18.732131-08:00","dependencies":[{"issue_id":".flake-c1t.7","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:15:21.389471-08:00","created_by":"Cody Wright"},{"issue_id":".flake-c1t.7","depends_on_id":".flake-c1t.1","type":"blocks","created_at":"2026-02-08T00:19:09.499272-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.8","title":"US-008: Create state-version and hostname aspects following vix pattern","description":"Create small, focused aspects for state version and hostname following vix's clean patterns.\n\n## Reference (vix)\n\n### state-version.nix (7 lines)\n```nix\n{\n  my.state-version = {\n    nixos.system.stateVersion = \"25.11\";\n    homeManager.home.stateVersion = \"25.11\";\n    darwin.system.stateVersion = 6;\n  };\n}\n```\n\n### hostname.nix (5 lines)\n```nix\n{\n  vix.hostname = { host, ... }: {\n    ${host.class}.networking.hostName = host.hostName;\n  };\n}\n```\n\n## Current State\n- stateVersion is set in modules/defaults.nix and scattered\n- Hostname is set in modules/dendritic/host.nix with explicit class blocks\n\n## Changes Required\n1. Create `modules/config/state-version.nix`:\n   ```nix\n   {\n     FTS.state-version = {\n       nixos.system.stateVersion = \"25.11\";\n       homeManager.home.stateVersion = \"25.11\";\n       darwin.system.stateVersion = 6;\n     };\n   }\n   ```\n\n2. Create `modules/config/hostname.nix`:\n   ```nix\n   {\n     FTS.hostname = { host, ... }: {\n       ${host.class}.networking.hostName = host.hostName;\n     };\n   }\n   ```\n\n3. Include both in den.default.includes\n4. Remove old hostname logic from dendritic/host.nix\n5. Remove scattered stateVersion settings\n\n## Acceptance Criteria\n- [ ] FTS.state-version aspect created with all three class versions\n- [ ] FTS.hostname aspect created using dynamic ${host.class} pattern\n- [ ] Both included in den.default.includes\n- [ ] Old dendritic/host.nix hostname logic removed or simplified\n- [ ] No duplicate stateVersion settings remain\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"closed","priority":1,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:15:33.328561-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:31:18.318509-08:00","closed_at":"2026-02-09T01:31:18.318509-08:00","close_reason":"Implemented on dedicated ralph-parallel branch; awaiting merge.","dependencies":[{"issue_id":".flake-c1t.8","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:15:33.332512-08:00","created_by":"Cody Wright"}]}
{"id":".flake-c1t.9","title":"US-009: Consolidate nix settings into single cross-platform aspect","description":"Consolidate scattered nix configuration into a single aspect following vix's nix-settings pattern.\n\n## Reference (vix nix-setttings.nix)\n```nix\nlet\n  my.nix-settings = {\n    nixos = nix-settings;\n    darwin = nix-settings;\n  };\n\n  nix-settings = { pkgs, config, ... }: {\n    nix = {\n      optimise.automatic = true;\n      settings = {\n        experimental-features = [ \"nix-command\" \"flakes\" ];\n        trusted-users = [ \"root\" \"@wheel\" ];\n      };\n      gc = pkgs.lib.optionalAttrs config.nix.enable {\n        automatic = true;\n        options = \"--delete-older-than 7d\";\n      };\n    };\n  };\nin\n{ inherit my; }\n```\n\n## Current State\nNix configuration is spread across:\n- modules/nix/nix.nix (nix facet)\n- modules/nix/nixpkgs.nix\n- modules/nix/experimental-features.nix (separate aspect just for flakes features)\n- modules/aspects/defaults.nix (references multiple nix-related aspects)\n\n## Changes Required\n1. Consolidate nix settings into `modules/config/nix-settings.nix` using let...in pattern\n2. Share config between nixos and darwin using single function\n3. Merge experimental-features into nix-settings (it's 2 lines of config)\n4. Keep nixpkgs-specific config (overlays, unfree) separate if complex\n5. Update defaults to reference consolidated aspect\n\n## Acceptance Criteria\n- [ ] Single nix-settings aspect handles both nixos and darwin nix config\n- [ ] experimental-features folded into nix-settings (not a separate aspect)\n- [ ] Uses let...in pattern for shared logic\n- [ ] gc, optimise, trusted-users, substituters all in one place\n- [ ] `just fmt` passes\n- [ ] `just build voyager` or equivalent builds successfully","status":"closed","priority":2,"issue_type":"task","owner":"acodywright@gmail.com","created_at":"2026-02-08T00:15:52.087609-08:00","created_by":"Cody Wright","updated_at":"2026-02-09T01:31:18.319435-08:00","closed_at":"2026-02-09T01:31:18.319435-08:00","close_reason":"Implemented on dedicated ralph-parallel branch; awaiting merge.","dependencies":[{"issue_id":".flake-c1t.9","depends_on_id":".flake-c1t","type":"parent-child","created_at":"2026-02-08T00:15:52.089594-08:00","created_by":"Cody Wright"}]}
